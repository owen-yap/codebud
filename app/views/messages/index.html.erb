<%= link_to "< Back", root_path, class: "muted mt-2 ml-4" %>
<div class="msg-container">
  <div class="row align-items-start">
    <!-- Question -->
    <div class="col-6 pl-5">
      <div class="card-template question mb-3 mt-2">
        <div class="info">
          <h3 class="title mb-2">Question: <%= @question.title %> </h3>
          <div class="tags">
            <% @question.skills.each do |skill| %>
              <p class="card-tag"> <%= skill.name %> </p>
            <% end %>
          </div>
          <div>
            <p>Meeting Time: <%= "#{@question.selected_proposal.meeting_time}" %> &nbsp; &nbsp; &nbsp; &nbsp;
            <%= "Price: #{@question.selected_proposal.price}"%></p>
          </div>
        </div>
      </div>
      <div class="card-white line-numbers language-css">
        <p class="card-tag mb-0"> <%= @question.rich_body %></p>
      </div>
      <!-- session finished button -->
      <div class='mt-3'>
        <% if current_user.tutor %>
          <% if @question.selected_proposal.order.status != "completed" %>
            <%= simple_form_for @question.selected_proposal.order do |f| %>
              <%= f.input :status, as: :hidden, input_html: {value: "completed" } %>
              <%= f.submit 'Session Finished', class: "btn dark-btn", id: "complete-btn" %>
            <% end %>
          <% else %>
            <%= link_to "Back to Dashboard", root_path, class: "btn light-btn mt-4" %>
          <% end %>
        <% else %>
          <% if @question.selected_proposal.order.status == 'completed' %>
            <h5>Tutor has marked this session as completed</h5>
            <button class='btn light-btn'>Open Dispute</button>
            <%= link_to 'Review', new_order_review_path(@question.selected_proposal.order), class: "btn dark-btn" %>
          <% end %>
        <% end %>
      </div>
    </div>
    <!-- message window -->
    <div class="col-6">
      <div class="msg-container-sm mt-3">
        <h6><strong>#Qn-<%= @question.title %></strong></h6>
        <div id="messages" data-question-id="<%= @question.id %>" data-current-user-id="<%=current_user.id%>">
          <% @question.messages.each do |message| %>
            <div class="message-container" id="message-<%= message.id %>" data-user-id="<%=message.user.id%>">
              <i class="author">
                <span><%= message.sender.username %></span>
                <small><%= message.created_at.strftime("%a %b %e at %l:%M%p") %></small>
              </i>
              <p><%= message.content %></p>
            </div>
          <% end %>
        </div>
        <div class= "mt-2">
          <%= simple_form_for [ @question, @message ] do |f| %>
            <%= f.input :content, label: false, placeholder: "type your message" %>
            <%= f.submit ' âž¢ ', data: { disable_with: false } %>
          <% end %>
        </div>
      </div>
      <%= link_to "Enter video call", create_room_path(@order), class: "btn light_btn" %>
    </div>
  </div>
</div>
